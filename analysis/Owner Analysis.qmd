---
title: "Owner Analysis"
author: "Brooke Helmick" and "Ben Grime
format: html
---

## Exercise: Explore, Clean, and Wrangle Data
```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(here)
library(janitor)
```


## Read in the data and store as lobster abundance
```{r}
lobster_abundance <- read_csv(here::here("data/Lobster_Abundance_All_Years_20220829.csv"))
```


## Explore the data
```{r}
glimpse(lobster_abundance)
head(lobster_abundance)
colnames(lobster_abundance)
unique(lobster_abundance$SITE)

```

## Clean and Reshape the Data

### Get the data ready for cleaning
```{r}
lobster_abundance <- lobster_abundance %>% 
  janitor::clean_names()

colnames(lobster_abundance)
```


### Convert missing values using 'mutate()' and 'na.if()'
```{r}
lobster_abundance <- lobster_abundance %>% 
  mutate(size_mm = na_if(size_mm, -99999))

head(lobster_abundance)
```

### 'filter()' practice
```{r}
not_napl <- lobster_abundance %>% 
  filter(site != "NAPL")

unique(not_napl$site)
```


### Create and store a subset of lobsters at Arroy Quemado (AQUE) AND with a carapace length greater than 70 mm
```{r}
aque_70mm <- lobster_abundance %>% 
  filter(site == "AQUE" & size_mm >= 70)

summary(aque_70mm$size_mm)
```


### find maximum carapace length using 'max()' and group by site and month. ?max
```{r}
max_lobster <- lobster_abundance %>% 
  group_by(site, month) %>% 
  summarize(max_length = max(size_mm, na.rm = TRUE))

max_lobster
```


# Create visually appealing informative data visualization

## Create a multipanel plot of lobster carapace length (size_mm) using 'ggplot()', 'geom_histogram(), and 'facet_wrap()'. Use the variable (site) in 'facet_wrap()'. Use object lobster abundance.

```{r}
ggplot(data = lobster_abundance,
       aes(x = size_mm)) +
  geom_histogram() +
  facet_wrap(~site)
```


## Create a line graph of the number of total lobsters observed (y-axis) by year (x-axis) in the study, grouped by SITE.

### group by site and year and caculate total lobsters
```{r}
lobster_summarize <- lobster_abundance %>% 
  group_by(site, year) %>% 
  summarize(count = n())
```


### create line graph using 'ggplot()' and 'geom_line()'
```{r}
# line plot
ggplot(data = lobster_summarize,
       aes(x = year, y = count))+
  geom_line(aes(color = site))

# line and point plot
ggplot(data = lobster_summarize,
       aes(x = year, y = count))+
  geom_line(aes(color = site))+
  geom_point(aes(color = site))
```


## Create a bar graph that shows the amount of small and large sized carapace lobsters at each SITE from 2019-2021. Note: The small and large metrics are completely made up and are not based on any known facts.

## Define the small and large lobster sizes
```{r}
lobster_size_lrg <- lobster_abundance %>% 
  filter(year %in% c(2019, 2020, 2021)) %>% 
  mutate(size_bin = if_else(size_mm <=70, true = "small", false = "large")) %>%
  group_by(site, size_bin) %>% 
  summarize(count = n()) %>% 
  drop_na()
  

lobster_size_lrg
```

## create bar plot of the above and use 'position = "dodge:'
```{r}
# bar plot
ggplot(data = lobster_size_lrg,
       aes(x = site, y = count,
           fill = size_bin))+
  geom_col()

# dodged bar plot
ggplot(data = lobster_size_lrg,
       aes(x = site, y = count,
           fill = size_bin))+
  geom_col(position = "dodge")+
  labs(x = "Site Name",
         y = "Count (# lobster)",
         fill = "lobster size",
         title = "Total number of lobster per site",
         subtitle = "Total number of lobster designated by small (<70mm) and large (>70mm)")+
  theme_bw()
```


## Save plots into a folder
```{r}
library(here)

ggsave(here::here("plots/total_number_lobster_per_site.jpg"), width = 12, height = 6, units = "in")
```









